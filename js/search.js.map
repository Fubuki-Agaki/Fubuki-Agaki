{"version":3,"names":["searchFunc","path","searchId","contentId","$","ajax","url","dataType","success","xmlResponse","datas","map","title","this","text","content","attr","get","$input","document","getElementById","$resultContent","addEventListener","resultList","keywords","i","j","result","length","push","slice","join","getAllCombinations","value","trim","toLowerCase","split","sort","a","b","innerHTML","forEach","data","matches","dataTitle","dataTitleLowerCase","dataContent","replace","dataContentLowerCase","dataUrl","indexTitle","indexContent","firstOccur","keyword","indexOf","searchResult","rank","str","start","end","matchContent","substring","regS","RegExp"],"sources":["search.js.map"],"sourcesContent":["// A local search script with the help of\n// [hexo-generator-search](https://github.com/PaicHyperionDev/hexo-generator-search)\n// Copyright (C) 2015\n// Joseph Pan <http://github.com/wzpan>\n// Shuhao Mao <http://github.com/maoshuhao>\n// This library is free software; you can redistribute it and/or modify\n// it under the terms of the GNU Lesser General Public License as\n// published by the Free Software Foundation; either version 2.1 of the\n// License, or (at your option) any later version.\n//\n// This library is distributed in the hope that it will be useful, but\n// WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n// Lesser General Public License for more details.\n//\n// You should have received a copy of the GNU Lesser General Public\n// License along with this library; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA\n// 02110-1301 USA\n//\n// Modified by:\n// Pieter Robberechts <http://github.com/probberechts>\n\n/*exported searchFunc*/\nvar searchFunc = function(path, searchId, contentId) {\n\n  function stripHtml(html) {\n    html = html.replace(/<style([\\s\\S]*?)<\\/style>/gi, \"\");\n    html = html.replace(/<script([\\s\\S]*?)<\\/script>/gi, \"\");\n    html = html.replace(/<figure([\\s\\S]*?)<\\/figure>/gi, \"\");\n    html = html.replace(/<\\/div>/ig, \"\\n\");\n    html = html.replace(/<\\/li>/ig, \"\\n\");\n    html = html.replace(/<li>/ig, \"  *  \");\n    html = html.replace(/<\\/ul>/ig, \"\\n\");\n    html = html.replace(/<\\/p>/ig, \"\\n\");\n    html = html.replace(/<br\\s*[\\/]?>/gi, \"\\n\");\n    html = html.replace(/<[^>]+>/ig, \"\");\n    return html;\n  }\n\n  function getAllCombinations(keywords) {\n    var i, j, result = [];\n\n    for (i = 0; i < keywords.length; i++) {\n        for (j = i + 1; j < keywords.length + 1; j++) {\n            result.push(keywords.slice(i, j).join(\" \"));\n        }\n    }\n    return result;\n  }\n\n  $.ajax({\n    url: path,\n    dataType: \"xml\",\n    success: function(xmlResponse) {\n      // get the contents from search data\n      var datas = $(\"entry\", xmlResponse).map(function() {\n        return {\n          title: $(\"title\", this).text(),\n          content: $(\"content\", this).text(),\n          url: $(\"link\", this).attr(\"href\")\n        };\n      }).get();\n\n      var $input = document.getElementById(searchId);\n      if (!$input) { return; }\n      var $resultContent = document.getElementById(contentId);\n\n      $input.addEventListener(\"input\", function(){\n        var resultList = [];\n        var keywords = getAllCombinations(this.value.trim().toLowerCase().split(\" \"))\n          .sort(function(a,b) { return b.split(\" \").length - a.split(\" \").length; });\n        $resultContent.innerHTML = \"\";\n        if (this.value.trim().length <= 0) {\n          return;\n        }\n        // perform local searching\n        datas.forEach(function(data) {\n          var matches = 0;\n          if (!data.title || data.title.trim() === \"\") {\n            data.title = \"Untitled\";\n          }\n          var dataTitle = data.title.trim().toLowerCase();\n          var dataTitleLowerCase = dataTitle.toLowerCase();\n          var dataContent = stripHtml(data.content.trim());\n          var dataContentLowerCase = dataContent.toLowerCase();\n          var dataUrl = data.url;\n          var indexTitle = -1;\n          var indexContent = -1;\n          var firstOccur = -1;\n          // only match artiles with not empty contents\n          if (dataContent !== \"\") {\n            keywords.forEach(function(keyword) {\n              indexTitle = dataTitleLowerCase.indexOf(keyword);\n              indexContent = dataContentLowerCase.indexOf(keyword);\n\n              if( indexTitle >= 0 || indexContent >= 0 ){\n                matches += 1;\n                if (indexContent < 0) {\n                  indexContent = 0;\n                }\n                if (firstOccur < 0) {\n                  firstOccur = indexContent;\n                }\n              }\n            });\n          }\n          // show search results\n          if (matches > 0) {\n            var searchResult = {};\n            searchResult.rank = matches;\n            searchResult.str = \"<li><a href='\"+ dataUrl +\"' class='search-result-title'>\"+ dataTitle +\"</a>\";\n            if (firstOccur >= 0) {\n              // cut out 100 characters\n              var start = firstOccur - 20;\n              var end = firstOccur + 80;\n\n              if(start < 0){\n                start = 0;\n              }\n\n              if(start == 0){\n                end = 100;\n              }\n\n              if(end > dataContent.length){\n                end = dataContent.length;\n              }\n\n              var matchContent = dataContent.substring(start, end);\n\n              // highlight all keywords\n              var regS = new RegExp(keywords.join(\"|\"), \"gi\");\n              matchContent = matchContent.replace(regS, function(keyword) {\n                return \"<em class=\\\"search-keyword\\\">\"+keyword+\"</em>\";\n              });\n\n              searchResult.str += \"<p class=\\\"search-result\\\">\" + matchContent +\"...</p>\";\n            }\n            searchResult.str += \"</li>\";\n            resultList.push(searchResult);\n          }\n        });\n        if (resultList.length) {\n          resultList.sort(function(a, b) {\n              return b.rank - a.rank;\n          });\n          var result =\"<ul class=\\\"search-result-list\\\">\";\n          for (var i = 0; i < resultList.length; i++) {\n            result += resultList[i].str;\n          }\n          result += \"</ul>\";\n          $resultContent.innerHTML = result;\n        }\n      });\n    }\n  });\n};\n"],"mappings":"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"}